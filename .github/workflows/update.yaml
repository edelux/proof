---
name: Update Docker Image
run-name: Update Docker Image

on:
  workflow_dispatch:

jobs:
  update-image:
    runs-on: ubuntu-latest

    steps:
      - name: Pakackege list
        run: docker run --rm -i --entrypoint dpkg edelux/dns-proxy -l|awk '/^ii/{split($2,a,":");print a[1]","$3}' >package.old

      - name: New Package
        run: |
          PKGS=$(awk -F, '{printf $1" "}' package.old)
          docker run --rm -i debian:testing bash "apt update -qq && DEBIAN_FRONTEND=noninteractive sudo apt install -y $PKGS >/dev/null 2>&1 && apt list --installed 2>/dev/null"|awk -F/ '/\[installed/ {split($1,a,":"); split($2,b," "); print a[1] "," b[1]}' >package.new

      - name: Show list
        run: |
          echo "Installed" && cat package.old
          echo "Current"   && cat package.new
...
